var renderer=new marked.Renderer;renderer.code=function(e,t){var n='<pre class="prettyprint language-'+t+'">';return n+="<code>"+e+"</code>",n+="</pre>"},marked.setOptions({renderer:renderer,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0}),$("#btn_preview").click(function(e){e.preventDefault();var t=$("#comment");t.addClass("sr-only"),$(this).addClass("sr-only"),$("#btn_modify").removeClass("sr-only");var n=t.val(),a=marked(n);$(".preview").html(a),prettyPrint()}),$("#btn_modify").click(function(){event.preventDefault();var e=$("#comment");e.removeClass("sr-only").focus(),$(".preview").html(""),$(this).addClass("sr-only"),$("#btn_preview").removeClass("sr-only")}),$("#btn_submit").click(function(e){e.preventDefault();var t=$("#real_name").val(),n=$("#email").val(),a=$("#site").val(),r=$("#comment").val(),i=location.pathname.substr("/article/".length),s="",l=$("#create_comment").parent().parent().parent();l.hasClass("media")&&(s=l.attr("id")||"");var c={real_name:t,email:n,site:a,comment:r,article_id:i,comment_id:s};$.post("/comment/create",c,function(e){if("failed"==e.status){var t=$("div.alert-danger");t.find("strong").text(e.message),t.removeClass("sr-only")}else location.reload()},"json")});var $commentList=$("#comment_list");$commentList.find("div.reply").click(function(){var e=$("#create_comment");$(this).parent().siblings(".comment").append(e),$("#cancel_reply").removeClass("sr-only")}),$commentList.find("div.delete").click(function(){if(confirm("确定删除此条评论及其子评论吗?")){var e=$(this).parent().parent().parent(),t=[];t.push(e.attr("id")),e.find("div.media").each(function(){t.push($(this).attr("id"))}),$.post("/comment/delete",{comment_ids:t},function(e){"failed"==e.status?alert("删除失败!"):alert("删除成功!"),location.reload()},"json")}}),$("#cancel_reply").click(function(){var e=$("#create_comment");$("#cancel_reply").addClass("sr-only"),$("#comment_list").parent().parent().append(e)}),$(document).ready(function(){var e=$("#article_content"),t=e.html();t=t.replace(/^\s+|\s+$/g,"");var n=marked(t);e.html(n),$("div.comment").each(function(){var e=$(this).html();$(this).html(marked(e))}),prettyPrint()});
