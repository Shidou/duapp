$(document).ready(function(){var a=$("#manage_class");a.delegate("input","keydown",function(a){return!(32==a.keyCode)}),$("#add_class").click(function(){var a=$("#class_name"),n=a.val();if(a.val(""),""==n)$("p.warn").html("分类名称不能为空").removeClass("sr-only");else{var t=$("#class_list"),s=!1;if(t.find("input").each(function(){if(n==$(this).val()){s=!0;var a=$(this).parent();if(!a.hasClass("sr-only"))return $("p.warn").html("已经添加过此分类").removeClass("sr-only"),!1;a.removeClass("sr-only")}}),!s){var i="<div class='cell'><input type='text' class='col-md-5 pull-left' maxlength='20' value='"+n+"'><button class='btn btn-link pull-right'>删除</button></div>";t.append(i),$("p.warn").addClass("sr-only")}}}),a.delegate("button.btn-link","click",function(){$(this).parent().addClass("hidden")}),$("#save_class_change").click(function(){var a=$("#class_list"),n=[];a.find("input").each(function(){$(this).parent().hasClass("hidden")||n.push($(this).val())});for(var t=","+n.join()+",",s=0,i=n.length;i>s;s++){var e=t.indexOf(","+n[s]+","),l=t.lastIndexOf(","+n[s]+",");if(-1!=e&&-1!=l&&e!=l)return $("p.warn").html("分类名重复").removeClass("sr-only"),!1}var r=[];a.find("input").each(function(){var a={};void 0!=$(this).attr("id")?$(this).parent().hasClass("hidden")?(a._id=$(this).attr("id"),a.name=$(this).attr("name"),a.condition="delete",r.push(a)):$(this).val()!==$(this).attr("name")&&(a._id=$(this).attr("id"),a.name=$(this).val(),a.condition="modify",r.push(a)):$(this).parent().hasClass("hidden")||(a.name=$(this).val(),a.condition="add",r.push(a))}),$.post("/class/manage",{classes:r},function(){location.href="/content"},"json")})});
$(document).ready(function(){var t=$("#article_list"),a=$("#change_class"),e=$("#delete_dialog"),c="",i="";t.find("button.change").click(function(){c=$(this).val();var t=$(this).siblings("a").attr("href");i=t.substr(9,24);var e=$("#class_id");"undefined"!=c?e.val(c):e.val(0),a.modal()}),t.find("button.delete").click(function(){var t=$(this).siblings("a").attr("href");i=t.substr(9,24),e.modal()}),$("#save_class").click(function(){a.modal("hide");var t=$("#class_id").val();t!==c&&$.post("/article/change",{article_id:i,class_id:t},function(t){"success"==t.status?alert("分类修改成功!"):alert("分类修改失败!"),location.href="/content"},"json")}),$("#delete_article").click(function(){e.modal("hide"),$.post("/article/delete",{article_id:i},function(t){"success"==t.status?alert("博文删除成功!"):alert("博文删除失败失败!"),location.href="/content"},"json")})});
